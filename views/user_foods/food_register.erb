<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://unpkg.com/bootstrap-show-password@1.2.1/dist/bootstrap-show-password.min.js"></script>


<h1>食材登録画面</h1>

<%= erb :'user_foods/_user_food_row', locals: { food: nil, id: 'templateForm' } %>

<form action="/user_foods/register" method="post">
  <div class="rows" id="displayArea">
    <div class="form-row mb-2">
      <div class="col-4">食材名</div>
      <div class="col-4">賞味期限</div>
      <div class="col-3">グラム</div>
    </div>

    <% if @user_foods %>
      <% @user_foods.each do |food| %>
        <%= erb :'user_foods/_user_food_row', locals: { food: food, id: '' } %>

        <div name="errors" class="row mb-2">
          <%= erb :'shared/_field_errors', locals: { model: food, column: :name } %>
          <%= erb :'shared/_field_errors', locals: { model: food, column: :limit_date } %>
          <%= erb :'shared/_field_errors', locals: { model: food, column: :gram } %>
        </div>
      <% end %>

    <% else %>
      <%= erb :'user_foods/_user_food_row', locals: { food: nil, id: '' } %>
    <% end %>
  </div>

  <button
    type="button"
    id="addButton"
    class="btn btn-lg btn-outline-success rounded-circle p-0 d-block mx-auto mb-4 mt-4"
    style="width:3rem; height:3rem;"
  >
    <i class="fas fa-plus"></i>
  </button>

  <button type="submit" class="btn btn-primary d-block ml-auto mb-2">
    登録する
  </button>


  <style type="text/css">
    #templateForm {
      display: none;
    }
  </style>

  <script>
  $(function(){
      var idNo = 1;

      $('button#addButton').on('click',function(){
          let tempTr = $('#templateForm');
          tempTr
              .clone(true)
              .removeAttr("id")
              .appendTo('#displayArea');

          idNo++;
      });

      $('button[name=removeButton]').on('click',function(){
          let removeObj = $(this).closest('.form-row');
          if(removeObj.attr('id') != 'templateForm') {
              removeObj.next('*[name=errors]').remove();
              removeObj.remove();
          }
      });

  });
  </script>

</form>
