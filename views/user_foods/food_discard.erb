<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://unpkg.com/bootstrap-show-password@1.2.1/dist/bootstrap-show-password.min.js"></script>

<h1>廃棄した食材の登録</h1>

<%= erb :'user_foods/_show_message' %>

<form action="/user_foods/food_discard" method="post">
  <div>
    <table>
      <thead>
        <tr>
          <th>食材名</th>
          <th>グラム数</th>
        </tr>
      </thead>

      <tbody id="displayArea">
        <tr id="templateForm" class="NotDisp">
          <td>
            <input name="items[][food_name]" class="form-control mb-2" type="text" placeholder="食材名" />
          </td>
          <td>
            <input name="items[][gram]" class="form-control mb-2" type="number" placeholder="食材の重さ(g)" />
          </td>
          <td>
            <button type="button" name="removeButton" class="btn btn-danger mb-2">-</button>
          </td>
        </tr>

        <tr>
          <td>
            <input name="items[][food_name]" class="form-control mb-2" type="text" placeholder="食材名">
          </td>
          <td>
            <input name="items[][gram]" class="form-control mb-2" type="number" placeholder="食材の重さ(g)">
          </td>
          <td>
            <button type="button" name="removeButton" class="btn btn-danger mb-2">-</button>
          </td>
        </tr>
      </tbody>
    </table>

    <button type="button" id="addButton" class="btn btn-lg btn-block btn-success mb-2">
      追加
    </button>
  </div>

  <hr>

  <input type="reset" class="btn btn-secondary mb-2" value="取り消し">
  <button type="submit" class="btn btn-primary mb-2">登録</button>

  <style type="text/css">
    .NotDisp {
      display: none;
    }
  </style>

  <script>
  $(function(){
      var idNo = 1;

      $('button#addButton').on('click',function(){
          let tempTr = $('#templateForm');
          tempTr
              .clone(true)
              .removeAttr("id")
              .removeClass("NotDisp")
              .appendTo('#displayArea');

          idNo++;
      });

      $('button[name=removeButton]').on('click',function(){
          let removeObj = $(this).closest('tr');
          if(removeObj.attr('id') != 'templateForm') {
              removeObj.remove();
          }
      });

      $("form").on('submit',function(){
        let error;
        $('table tr[class!="NotDisp"] input[name="items[][food_name]"]').each(function(){
          if($(this).val() == ""){
            error = true;
            return false;
          }
        });

        if(error){
          alert("食材名は必須項目です！！！！");
          return false;
        }
      });
  });
  </script>

</form>
