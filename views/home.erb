<div class="recipe">
  <h4 class="recipe-title">今日のおすすめ</h4>
  <div class="slider">
    <div class="shadow">
      <img 
        class="recipe_image rounded border border-dark"
        src="<%= @recommend_recipe.present? ? @recommend_recipe[:recipe_image] : '' %>"
        data-toggle="modal"
        data-target="#recommend-modal"
      >
    </div>
    <div class="shadow">
      <img 
        class="recipe_image rounded border border-dark"
        src="<%= @recommend_recipe.present? ? @recommend_recipe[:recipe_image] : '' %>"
        data-toggle="modal"
        data-target="#recommend-modal"
      >
    </div>
    <div class="shadow">
      <img 
        class="recipe_image rounded border border-dark"
        src="<%= @recommend_recipe.present? ? @recommend_recipe[:recipe_image] : '' %>"
        data-toggle="modal"
        data-target="#recommend-modal"
      >
    </div>
    <div class="shadow">
      <img 
        class="recipe_image rounded border border-dark"
        src="<%= @recommend_recipe.present? ? @recommend_recipe[:recipe_image] : '' %>"
        data-toggle="modal"
        data-target="#recommend-modal"
      >
    </div>
  </div>
  <button class="btn btn-brown btn-block" onclick="window.location.reload();">
    レシピをもっと見る&nbsp;<i class="fas fa-chevron-circle-right"></i>
  </button>
  <% if @recommend_recipe.present? %>
    <%= erb :'_recommend_recipe_modal', locals: { recipe: @recommend_recipe, refrigerator_foods: @user_foods } %>
  <% end %>
</div>
<div class="row">
  <div class="col-md-5">
    <h4>冷蔵庫</h4>
    <div class="show_food">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th scope="col">食材名</th>
            <th scope="col">g</th>
            <th scope="col">期限</th>
          </tr>
        </thead>
        <tbody>
        <% @user_foods.each do |item|%>
          <% if item.limit_date.present? %>
            <% if Time.new.strftime("%Y-%m-%d") > item.limit_date.to_s %>
              <tr class="table-danger">
                <td><%= item.name %></td>
                <td><%= "#{item.gram}g" if item.gram.present? %></td>
                <td><%= item.limit_date %></td>
              </tr>
            <% elsif Time.new.strftime("%Y-%m-%d") > (item.limit_date - 3).to_s %>
              <tr class="table-warning">
                <td><%= item.name %></td>
                <td><%= "#{item.gram}g" if item.gram.present? %></td>
                <td><%= item.limit_date %></td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td><%= item.name %></td>
              <td><%= "#{item.gram}g" if item.gram.present? %></td>
              <td></td>
            </tr>
          <% end %>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="col-md-7">
    <% if @current_user %>
        <% if gon.monthly_kill_retios.present? && gon.daily_kill_retios.present? %>
          <div class="kill_button_group">
            <button class="btn page-link text-dark d-inline-block rounded-pill monthly_kill_button">
              年間
            </button>
            <button class="btn page-link text-dark d-inline-block rounded-pill daily_kill_button">
              月間
            </button>
          </div>
          <div class="kill_retios">
            <div class="kill_retio_graph" id="monthly_kill_retios_graph" style="width:100%;"></div>
            <div class="kill_retio_graph" id="daily_kill_retios_graph" style="width:100%;"></div>
          </div>
        <% else %>
          <div>
            <p>Nothing data.</p>
          </div>
        <% end %>

        <% if gon.monthly_contributes.present? && gon.daily_contributes.present? %>
          <div class="contributes_button_group">
            <button class="btn page-link text-dark d-inline-block rounded-pill monthly_contributes_button">
              年間
            </button>
            <button class="btn page-link text-dark d-inline-block rounded-pill daily_contributes_button">
              月間
            </button>
          </div>
          <div class="contributes">
            <div class="contribute_graph" id="monthly_contirbutes_graph" style="width:100%;"></div>
            <div class="contribute_graph" id="daily_contirbutes_graph" style="width:100%;"></div>
          </div>
        <% else %>
          <div>
            <p>Nothing data.</p>
          </div>
        <% end %>

    <% else %>
      <div>
        <p>Don't use, when not logged in.</p>
      </div>
    <% end %>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="/js/make_kill_graph.js"></script>
<script type="text/javascript" src="/js/make_contribute_graph.js"></script>
<script type="text/javascript" src="/js/switch_graph_in_button.js"></script>
<script type="text/javascript">
$(function(){
  $('.slider').slick({
    infinite: true,
    slidesToShow: 3,
    slidesToScroll: 3,
    prevArrow: '<span class="slide-arrow prev-arrow"><i class="fas fa-chevron-left"></i></span>',
    nextArrow: '<span class="slide-arrow next-arrow"><i class="fas fa-chevron-right"></i></span>',
    responsive: [
    {
      breakpoint: 768,
      settings: {
        slidesToShow: 2,
        slidesToScroll: 2,
      }
    },
    {
      breakpoint: 480,
      settings: {
        slidesToShow: 1,
        slidesToScroll: 1,
      }
    }
    ]
  });
});
</script>